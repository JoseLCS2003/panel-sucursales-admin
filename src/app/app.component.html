<!-- Contenedor Principal. Muestra el Login o el Panel según isAuthenticated -->

<div
  *ngIf="!isAuthenticated"
  class="flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-4"
>
  <div
    class="w-full max-w-md bg-white p-8 rounded-2xl shadow-2xl space-y-6 border border-gray-100"
  >
    <div class="text-center">
      <div
        class="mx-auto w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center mb-4 shadow-lg"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="32"
          height="32"
          viewBox="0 0 24 24"
          fill="none"
          stroke="white"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
          <polyline points="9 22 9 12 15 12 15 22" />
        </svg>
      </div>
      <h2 class="text-3xl font-bold text-gray-800 mb-2">Panel de Sucursales</h2>
      <p class="text-gray-500">Ingresa tus credenciales para continuar</p>
    </div>

    <!-- Formulario de Login -->
    <!-- Formulario de Login -->
    <form *ngIf="!requires2FA" (submit)="login($event)" class="space-y-6">
      <div>
        <label
          for="username"
          class="block text-sm font-medium text-gray-700 mb-2"
          >Correo Electrónico</label
        >
        <div class="relative">
          <div
            class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="text-gray-400"
            >
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
              <circle cx="12" cy="7" r="4" />
            </svg>
          </div>
          <input
            type="text"
            id="username"
            [(ngModel)]="username"
            name="username"
            class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-xl leading-5 bg-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 sm:text-sm"
            placeholder="admin@empresa.com"
            required
          />
        </div>
      </div>

      <div>
        <label
          for="password"
          class="block text-sm font-medium text-gray-700 mb-2"
          >Contraseña</label
        >
        <div class="relative">
          <div
            class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="text-gray-400"
            >
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
              <path d="M7 11V7a5 5 0 0 1 10 0v4" />
            </svg>
          </div>
          <input
            type="password"
            id="password"
            [(ngModel)]="password"
            name="password"
            class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-xl leading-5 bg-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 sm:text-sm"
            placeholder="••••••••"
            required
          />
        </div>
      </div>

      <div
        *ngIf="loginError"
        class="flex items-center p-3 bg-red-50 rounded-xl border border-red-100 animate-pulse"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="text-red-500 flex-shrink-0 mr-2"
        >
          <circle cx="12" cy="12" r="10" />
          <line x1="12" x2="12" y1="8" y2="12" />
          <line x1="12" x2="12.01" y1="16" y2="16" />
        </svg>
        <p class="text-sm text-red-700 font-medium">{{ loginError }}</p>
      </div>

      <button
        type="submit"
        [disabled]="loading"
        class="w-full py-3 px-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:from-blue-700 hover:to-indigo-700 transition duration-300 transform hover:-translate-y-0.5 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"
      >
        {{ loading ? "Iniciando Sesión..." : "Iniciar Sesión" }}
      </button>
    </form>

    <!-- Formulario de Verificación 2FA -->
    <div *ngIf="requires2FA" class="space-y-6">
      <div class="text-center mb-6">
        <div
          class="mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="32"
            height="32"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="text-blue-600"
          >
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
            <path d="M7 11V7a5 5 0 0 1 10 0v4" />
          </svg>
        </div>
        <h3 class="text-xl font-bold text-gray-900">
          Verificación de Dos Pasos
        </h3>
        <p class="text-sm text-gray-500 mt-2">
          Hemos enviado un código de verificación a tu correo electrónico:
          <strong>{{ username }}</strong>
        </p>
      </div>

      <div>
        <label for="code" class="block text-sm font-medium text-gray-700 mb-2"
          >Código de Verificación</label
        >
        <input
          type="text"
          id="code"
          [(ngModel)]="twoFactorCode"
          name="code"
          class="block w-full text-center tracking-[0.5em] text-2xl font-bold py-3 border border-gray-300 rounded-xl bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200"
          placeholder="000000"
          maxlength="6"
        />
      </div>

      <div
        *ngIf="loginError"
        class="flex items-center p-3 bg-red-50 rounded-xl border border-red-100"
      >
        <p class="text-sm text-red-700 font-medium w-full text-center">
          {{ loginError }}
        </p>
      </div>

      <button
        (click)="verify2FA()"
        [disabled]="loading || twoFactorCode.length !== 6"
        class="w-full py-3 px-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:from-blue-700 hover:to-indigo-700 transition duration-300 transform hover:-translate-y-0.5 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"
      >
        {{ loading ? "Verificando..." : "Verificar Código" }}
      </button>

      <div class="text-center mt-4">
        <button
          (click)="resend2FA()"
          class="text-sm text-blue-600 hover:text-blue-800 font-medium focus:outline-none"
        >
          ¿No recibiste el código? Reenviar
        </button>
      </div>

      <div class="text-center mt-2">
        <button
          (click)="requires2FA = false; loginError = ''"
          class="text-sm text-gray-500 hover:text-gray-700 focus:outline-none"
        >
          Volver al inicio de sesión
        </button>
      </div>
    </div>

    <div class="pt-4 border-t border-gray-200">
      <p class="text-xs text-center text-gray-500">
        <span class="font-semibold">Credenciales de prueba:</span><br />
        Usuario: <code class="bg-gray-100 px-2 py-1 rounded">admin</code> |
        Contraseña: <code class="bg-gray-100 px-2 py-1 rounded">password</code>
      </p>
    </div>
  </div>
</div>

<div
  *ngIf="isAuthenticated"
  class="min-h-screen bg-gray-50 flex transition-all duration-300"
>
  <!-- Barra lateral (Sidebar) -->
  <aside
    [class.w-64]="isSidebarOpen"
    [class.w-20]="!isSidebarOpen"
    [class.-translate-x-full]="!isSidebarOpen && isMobile"
    class="fixed inset-y-0 left-0 bg-gradient-to-b from-gray-900 via-gray-800 to-gray-900 text-white shadow-2xl z-30 transition-all duration-300 md:translate-x-0"
  >
    <div
      class="p-4 flex items-center justify-center h-16 border-b border-gray-700"
    >
      <span
        *ngIf="isSidebarOpen"
        class="text-2xl font-bold tracking-wider bg-gradient-to-r from-blue-400 to-indigo-400 bg-clip-text text-transparent"
      >
        Admin Panel
      </span>
      <svg
        *ngIf="!isSidebarOpen"
        xmlns="http://www.w3.org/2000/svg"
        width="28"
        height="28"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="text-blue-400"
      >
        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
        <polyline points="9 22 9 12 15 12 15 22" />
      </svg>
    </div>

    <nav class="flex flex-col p-3 space-y-2 mt-4">
      <a
        *ngFor="let item of navItems"
        (click)="setActiveSection(item.id)"
        [class.bg-gradient-to-r]="activeSection === item.id"
        [class.from-blue-600]="activeSection === item.id"
        [class.to-indigo-600]="activeSection === item.id"
        [class.shadow-lg]="activeSection === item.id"
        [class.hover:bg-gray-700]="activeSection !== item.id"
        class="flex items-center rounded-xl p-3 cursor-pointer transition-all duration-200 group"
        [title]="item.name"
      >
        <!-- Icono Panel Sucursales -->
        <svg
          *ngIf="item.id === 'Panel Sucursales'"
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="w-6 h-6 flex-shrink-0"
        >
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
          <polyline points="9 22 9 12 15 12 15 22" />
        </svg>

        <!-- Icono Clientes -->
        <svg
          *ngIf="item.id === 'Clientes'"
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="w-6 h-6 flex-shrink-0"
        >
          <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
          <circle cx="9" cy="7" r="4" />
          <path d="M22 21v-2a4 4 0 0 0-3-3.87" />
          <path d="M16 3.13a4 4 0 0 1 0 7.75" />
        </svg>

        <!-- Icono Empleados -->
        <svg
          *ngIf="item.id === 'Empleados'"
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="w-6 h-6 flex-shrink-0"
        >
          <rect width="20" height="14" x="2" y="7" rx="2" ry="2" />
          <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" />
        </svg>

        <!-- Icono Estadísticas -->
        <svg
          *ngIf="item.id === 'Estadísticas'"
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="w-6 h-6 flex-shrink-0"
        >
          <path d="M3 3v18h18" />
          <path d="m19 9-5 5-4-4-3 3" />
        </svg>

        <!-- Icono Configuración -->
        <svg
          *ngIf="item.id === 'Configuración'"
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="w-6 h-6 flex-shrink-0"
        >
          <circle cx="12" cy="12" r="3" />
          <path
            d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m6.36 6.36l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m6.36-6.36l4.24-4.24"
          />
        </svg>

        <span
          *ngIf="isSidebarOpen"
          class="ml-4 whitespace-nowrap text-sm font-medium"
        >
          {{ item.name }}
        </span>
      </a>
    </nav>

    <!-- Botón de Cerrar Sesión -->
    <button
      (click)="logout()"
      class="absolute bottom-4 left-2 right-2 flex items-center justify-center p-3 text-red-400 hover:bg-red-900 hover:bg-opacity-10 rounded-xl transition-all duration-200 border border-red-900 border-opacity-20 hover:border-opacity-40"
      [title]="isSidebarOpen ? 'Cerrar Sesión' : 'Salir'"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
        <polyline points="16 17 21 12 16 7" />
        <line x1="21" x2="9" y1="12" y2="12" />
      </svg>
      <span
        *ngIf="isSidebarOpen"
        class="ml-3 whitespace-nowrap text-sm font-medium"
      >
        Cerrar Sesión
      </span>
    </button>
  </aside>

  <!-- Overlay para móviles cuando el sidebar está abierto -->
  <div
    *ngIf="isSidebarOpen && isMobile"
    (click)="toggleSidebar()"
    class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-20 md:hidden transition-opacity duration-300"
  ></div>

  <!-- Contenido Principal -->
  <div
    [class.md:ml-64]="isSidebarOpen"
    [class.md:ml-20]="!isSidebarOpen"
    class="flex-1 transition-all duration-300 ml-0"
  >
    <!-- Barra superior (Header) -->
    <header
      class="sticky top-0 bg-white bg-opacity-80 shadow-sm z-10 h-16 flex items-center justify-between px-6 border-b border-gray-200"
    >
      <!-- Botón de alternancia de la barra lateral -->
      <button
        (click)="toggleSidebar()"
        class="p-2 rounded-xl hover:bg-gray-100 focus:outline-none transition duration-200"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="text-gray-600"
        >
          <line x1="4" x2="20" y1="12" y2="12" />
          <line x1="4" x2="20" y1="6" y2="6" />
          <line x1="4" x2="20" y1="18" y2="18" />
        </svg>
      </button>

      <!-- Título de la sección actual -->
      <h1 class="text-xl font-bold text-gray-800">{{ activeSectionTitle }}</h1>

      <!-- Perfil de usuario / Notificaciones -->
      <div class="flex items-center space-x-3">
        <button
          class="relative p-2 rounded-xl hover:bg-gray-100 transition duration-200"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="text-gray-600"
          >
            <path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9" />
            <path d="M10.3 21a1.94 1.94 0 0 0 3.4 0" />
          </svg>
          <span
            class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"
          ></span>
        </button>
        <div
          class="w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center text-white font-bold shadow-lg"
        >
          AD
        </div>
      </div>
    </header>

    <!-- Área de Contenido Dinámico -->
    <main class="p-6 md:p-10">
      <!-- Panel Sucursales (Vista principal) -->
      <section *ngIf="activeSection === 'Panel Sucursales'">
        <!-- Tarjetas de Estadísticas -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
          <!-- Total Sucursales -->
          <div
            class="bg-white p-6 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 border border-gray-100"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-500 font-semibold mb-1">
                  Total Sucursales
                </p>
                <p class="text-3xl font-bold text-gray-900">
                  {{ getTotalSucursales() }}
                </p>
              </div>
              <div class="p-4 bg-blue-100 rounded-2xl">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="28"
                  height="28"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="text-blue-600"
                >
                  <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                  <polyline points="9 22 9 12 15 12 15 22" />
                </svg>
              </div>
            </div>
          </div>

          <!-- Sucursales Activas -->
          <div
            class="bg-white p-6 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 border border-gray-100"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-500 font-semibold mb-1">
                  Sucursales Activas
                </p>
                <p class="text-3xl font-bold text-green-600">
                  {{ getSucursalesActivas() }}
                </p>
              </div>
              <div class="p-4 bg-green-100 rounded-2xl">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="28"
                  height="28"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="text-green-600"
                >
                  <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                  <polyline points="22 4 12 14.01 9 11.01" />
                </svg>
              </div>
            </div>
          </div>

          <!-- Total Empleados -->
          <div
            class="bg-white p-6 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 border border-gray-100"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-500 font-semibold mb-1">
                  Total Empleados
                </p>
                <p class="text-3xl font-bold text-purple-600">
                  {{ getTotalEmpleados() }}
                </p>
              </div>
              <div class="p-4 bg-purple-100 rounded-2xl">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="28"
                  height="28"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="text-purple-600"
                >
                  <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
                  <circle cx="9" cy="7" r="4" />
                  <path d="M22 21v-2a4 4 0 0 0-3-3.87" />
                  <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                </svg>
              </div>
            </div>
          </div>

          <!-- Capacidad Total -->
          <div
            class="bg-white p-6 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 border border-gray-100"
          >
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-500 font-semibold mb-1">
                  Capacidad Total
                </p>
                <p class="text-3xl font-bold text-orange-600">
                  {{ getCapacidadTotal() }}
                </p>
              </div>
              <div class="p-4 bg-orange-100 rounded-2xl">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="28"
                  height="28"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="text-orange-600"
                >
                  <rect width="18" height="18" x="3" y="3" rx="2" />
                  <path d="M3 9h18" />
                  <path d="M9 21V9" />
                </svg>
              </div>
            </div>
          </div>
        </div>

        <!-- Tabla de Sucursales -->
        <div
          class="bg-white rounded-2xl shadow-lg overflow-hidden border border-gray-100"
        >
          <div
            class="px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-gray-50 to-gray-100"
          >
            <div class="flex items-center justify-between">
              <h2 class="text-xl font-bold text-gray-800">
                Listado de Sucursales
              </h2>
              <button
                (click)="openCreateSucursalModal()"
                class="px-4 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl hover:shadow-lg transition-all duration-200 font-semibold text-sm"
              >
                + Nueva Sucursal
              </button>
            </div>
          </div>

          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th
                    class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"
                  >
                    Sucursal
                  </th>
                  <th
                    class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"
                  >
                    Dirección
                  </th>
                  <th
                    class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"
                  >
                    Contacto
                  </th>

                  <th
                    class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"
                  >
                    Capacidad
                  </th>
                  <th
                    class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"
                  >
                    Estado
                  </th>
                  <th
                    class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"
                  >
                    Acciones
                  </th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                <tr
                  *ngFor="let sucursal of sucursales"
                  class="hover:bg-gray-50 transition-colors duration-150"
                >
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center">
                      <div
                        class="w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center text-white font-bold mr-3"
                      >
                        {{ sucursal.nombre.charAt(0) }}
                      </div>
                      <div>
                        <div class="text-sm font-bold text-gray-900">
                          {{ sucursal.nombre }}
                        </div>
                        <div class="text-xs text-gray-500">
                          ID: {{ sucursal.id }}
                        </div>
                      </div>
                    </div>
                  </td>
                  <td class="px-6 py-4">
                    <div class="text-sm text-gray-900">
                      {{ sucursal.direccion }}
                    </div>
                  </td>
                  <td class="px-6 py-4">
                    <div class="text-sm text-gray-900">
                      {{ sucursal.telefono }}
                    </div>
                    <div class="text-xs text-gray-500">
                      {{ sucursal.email }}
                    </div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm font-semibold text-gray-900">
                      {{ sucursal.capacidad }}
                    </div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <span
                      *ngIf="sucursal.estado === 'activa'"
                      class="px-3 py-1 inline-flex text-xs leading-5 font-bold rounded-full bg-green-100 text-green-800 border border-green-200"
                    >
                      Activa
                    </span>
                    <span
                      *ngIf="sucursal.estado !== 'activa'"
                      class="px-3 py-1 inline-flex text-xs leading-5 font-bold rounded-full bg-red-100 text-red-800 border border-red-200"
                    >
                      Inactiva
                    </span>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm">
                    <div class="flex items-center space-x-2">
                      <button
                        class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors duration-150"
                        title="Editar"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="18"
                          height="18"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        >
                          <path
                            d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"
                          />
                          <path d="m15 5 4 4" />
                        </svg>
                      </button>
                      <button
                        class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors duration-150"
                        title="Eliminar"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="18"
                          height="18"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        >
                          <path d="M3 6h18" />
                          <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
                          <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
                        </svg>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Sección de Estadísticas -->
      <section *ngIf="activeSection === 'Estadísticas'">
        <h2 class="text-3xl font-bold text-gray-800 mb-6">
          Estadísticas Generales
        </h2>
        <div class="bg-white p-8 rounded-2xl shadow-lg border border-gray-100">
          <div
            class="h-96 flex items-center justify-center text-gray-400 border-2 border-dashed border-gray-300 rounded-xl"
          >
            <div class="text-center">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="64"
                height="64"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="mx-auto mb-4 text-gray-300"
              >
                <path d="M3 3v18h18" />
                <path d="m19 9-5 5-4-4-3 3" />
              </svg>
              <p class="text-lg font-semibold">Gráfico de Estadísticas</p>
              <p class="text-sm mt-2">(Área para integrar gráficos)</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Sección de Clientes -->
      <section *ngIf="activeSection === 'Clientes'">
        <h2 class="text-3xl font-bold text-gray-800 mb-6">
          Gestión de Clientes
        </h2>

        <div
          class="bg-white rounded-2xl shadow-lg overflow-hidden border border-gray-100"
        >
          <div
            class="px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-gray-50 to-gray-100"
          >
            <div class="flex items-center justify-between">
              <h3 class="text-xl font-bold text-gray-800">
                Listado de Clientes
              </h3>
              <button
                (click)="openCreateClienteModal()"
                class="px-4 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl hover:shadow-lg transition-all duration-200 font-semibold text-sm"
              >
                + Nuevo Cliente
              </button>
            </div>
          </div>

          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th
                    class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"
                  >
                    Cliente
                  </th>
                  <th
                    class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"
                  >
                    Email
                  </th>
                  <th
                    class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"
                  >
                    Sucursal
                  </th>
                  <th
                    class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"
                  >
                    Acciones
                  </th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                <tr
                  *ngFor="let cliente of clientes"
                  class="hover:bg-gray-50 transition-colors duration-150"
                >
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center">
                      <div
                        class="w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-600 rounded-xl flex items-center justify-center text-white font-bold mr-3"
                      >
                        {{ cliente.name.charAt(0) }}
                      </div>
                      <div>
                        <div class="text-sm font-bold text-gray-900">
                          {{ cliente.name }}
                        </div>
                        <div class="text-xs text-gray-500">
                          ID: {{ cliente.id }}
                        </div>
                      </div>
                    </div>
                  </td>
                  <td class="px-6 py-4">
                    <div class="text-sm text-gray-900">{{ cliente.email }}</div>
                  </td>
                  <td class="px-6 py-4">
                    <div class="text-sm text-gray-900">
                      {{ cliente.negocio?.nombre || "Sin asignar" }}
                    </div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm">
                    <div class="flex items-center space-x-2">
                      <button
                        class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors duration-150"
                        title="Editar"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="18"
                          height="18"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        >
                          <path
                            d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"
                          />
                          <path d="m15 5 4 4" />
                        </svg>
                      </button>
                      <button
                        (click)="deleteCliente(cliente.id!)"
                        class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors duration-150"
                        title="Eliminar"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="18"
                          height="18"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        >
                          <path d="M3 6h18" />
                          <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
                          <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
                        </svg>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Sección de Empleados -->
      <section *ngIf="activeSection === 'Empleados'">
        <h2 class="text-3xl font-bold text-gray-800 mb-6">
          Gestión de Empleados
        </h2>

        <div
          class="bg-white rounded-2xl shadow-lg overflow-hidden border border-gray-100"
        >
          <div
            class="px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-gray-50 to-gray-100"
          >
            <div class="flex items-center justify-between">
              <h3 class="text-xl font-bold text-gray-800">
                Listado de Empleados
              </h3>
              <button
                (click)="openCreateEmpleadoModal()"
                class="px-4 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl hover:shadow-lg transition-all duration-200 font-semibold text-sm"
              >
                + Nuevo Empleado
              </button>
            </div>
          </div>

          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th
                    class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"
                  >
                    Empleado
                  </th>
                  <th
                    class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"
                  >
                    Email
                  </th>
                  <th
                    class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"
                  >
                    Sucursal
                  </th>
                  <th
                    class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"
                  >
                    Acciones
                  </th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                <tr
                  *ngFor="let empleado of empleados"
                  class="hover:bg-gray-50 transition-colors duration-150"
                >
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center">
                      <div
                        class="w-10 h-10 bg-gradient-to-br from-green-500 to-teal-600 rounded-xl flex items-center justify-center text-white font-bold mr-3"
                      >
                        {{ empleado.name.charAt(0) }}
                      </div>
                      <div>
                        <div class="text-sm font-bold text-gray-900">
                          {{ empleado.name }}
                        </div>
                        <div class="text-xs text-gray-500">
                          ID: {{ empleado.id }}
                        </div>
                      </div>
                    </div>
                  </td>
                  <td class="px-6 py-4">
                    <div class="text-sm text-gray-900">
                      {{ empleado.email }}
                    </div>
                  </td>
                  <td class="px-6 py-4">
                    <div class="text-sm text-gray-900">
                      {{ empleado.negocio?.nombre || "Sin asignar" }}
                    </div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm">
                    <div class="flex items-center space-x-2">
                      <button
                        class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors duration-150"
                        title="Editar"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="18"
                          height="18"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        >
                          <path
                            d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"
                          />
                          <path d="m15 5 4 4" />
                        </svg>
                      </button>
                      <button
                        (click)="deleteEmpleado(empleado.id!)"
                        class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors duration-150"
                        title="Eliminar"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="18"
                          height="18"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        >
                          <path d="M3 6h18" />
                          <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
                          <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
                        </svg>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Sección de Configuración -->
      <section *ngIf="activeSection === 'Configuración'">
        <h2 class="text-3xl font-bold text-gray-800 mb-6">
          Configuración del Sistema
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div
            class="bg-white p-6 rounded-2xl shadow-lg border border-gray-100"
          >
            <div class="flex items-center mb-4">
              <div class="p-3 bg-blue-100 rounded-xl mr-4">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="text-blue-600"
                >
                  <circle cx="12" cy="12" r="3" />
                  <path
                    d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m6.36 6.36l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m6.36-6.36l4.24-4.24"
                  />
                </svg>
              </div>
              <h3 class="text-xl font-bold text-gray-800">Ajustes Generales</h3>
            </div>
            <p class="text-gray-600 mb-4">
              Configurar nombre de la aplicación, logo y preferencias generales
              del sistema.
            </p>
            <button
              class="px-4 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors duration-200 font-semibold text-sm"
            >
              Configurar
            </button>
          </div>

          <div
            class="bg-white p-6 rounded-2xl shadow-lg border border-gray-100"
          >
            <div class="flex items-center mb-4">
              <div class="p-3 bg-green-100 rounded-xl mr-4">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="text-green-600"
                >
                  <rect width="18" height="11" x="3" y="11" rx="2" ry="2" />
                  <path d="M7 11V7a5 5 0 0 1 10 0v4" />
                </svg>
              </div>
              <h3 class="text-xl font-bold text-gray-800">Seguridad</h3>
            </div>
            <p class="text-gray-600 mb-4">
              Gestión de roles, permisos de acceso y configuración de seguridad.
            </p>
            <button
              class="px-4 py-2 bg-green-600 text-white rounded-xl hover:bg-green-700 transition-colors duration-200 font-semibold text-sm"
            >
              Gestionar
            </button>
          </div>
        </div>
      </section>
    </main>
  </div>
</div>

<!-- Modal Backdrop -->
<div
  *ngIf="showModal"
  class="fixed inset-0 z-50 overflow-y-auto"
  aria-labelledby="modal-title"
  role="dialog"
  aria-modal="true"
>
  <div
    class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"
  >
    <!-- Background overlay -->
    <div
      class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
      aria-hidden="true"
      (click)="closeModal()"
    ></div>

    <!-- Modal panel -->
    <span
      class="hidden sm:inline-block sm:align-middle sm:h-screen"
      aria-hidden="true"
      >&#8203;</span
    >
    <div
      class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"
    >
      <!-- Modal Header -->
      <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
        <div class="sm:flex sm:items-start">
          <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
            <h3
              class="text-lg leading-6 font-medium text-gray-900"
              id="modal-title"
            >
              {{ isEditing ? "Editar" : "Crear" }}
              {{
                modalType === "sucursal"
                  ? "Sucursal"
                  : modalType === "cliente"
                  ? "Cliente"
                  : "Empleado"
              }}
            </h3>

            <!-- FORMULARIO SUCURSAL -->
            <div *ngIf="modalType === 'sucursal'" class="mt-4 space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Nombre</label
                >
                <input
                  type="text"
                  [(ngModel)]="currentSucursal.nombre"
                  class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Dirección</label
                >
                <input
                  type="text"
                  [(ngModel)]="currentSucursal.direccion"
                  class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Teléfono</label
                >
                <input
                  type="text"
                  [(ngModel)]="currentSucursal.telefono"
                  class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Email</label
                >
                <input
                  type="email"
                  [(ngModel)]="currentSucursal.email"
                  class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Capacidad</label
                >
                <input
                  type="number"
                  [(ngModel)]="currentSucursal.capacidad"
                  class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Estado</label
                >
                <select
                  [(ngModel)]="currentSucursal.estado"
                  class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                >
                  <option value="activa">Activa</option>
                  <option value="inactiva">Inactiva</option>
                </select>
              </div>
            </div>

            <!-- FORMULARIO USUARIO (CLIENTE/EMPLEADO) -->
            <div
              *ngIf="modalType === 'cliente' || modalType === 'empleado'"
              class="mt-4 space-y-4"
            >
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Nombre</label
                >
                <input
                  type="text"
                  [(ngModel)]="currentUsuario.name"
                  class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Email</label
                >
                <input
                  type="email"
                  [(ngModel)]="currentUsuario.email"
                  class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                />
              </div>
              <div *ngIf="!isEditing">
                <label class="block text-sm font-medium text-gray-700"
                  >Contraseña</label
                >
                <input
                  type="password"
                  [(ngModel)]="currentUsuario.password"
                  class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                />
              </div>

              <!-- Solo para empleados: Asignar Sucursal -->
              <div *ngIf="modalType === 'empleado'">
                <label class="block text-sm font-medium text-gray-700"
                  >Asignar Sucursal</label
                >
                <select
                  [(ngModel)]="currentUsuario.sucursal_id"
                  class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                >
                  <option [ngValue]="null">Sin asignar</option>
                  <option *ngFor="let s of sucursales" [value]="s.id">
                    {{ s.nombre }}
                  </option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal Footer -->
      <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
        <button
          type="button"
          [disabled]="loading"
          (click)="
            modalType === 'sucursal'
              ? saveSucursal()
              : modalType === 'cliente'
              ? saveCliente()
              : saveEmpleado()
          "
          class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50"
        >
          {{ loading ? "Guardando..." : "Guardar" }}
        </button>
        <button
          type="button"
          (click)="closeModal()"
          class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"
        >
          Cancelar
        </button>
      </div>
    </div>
  </div>
</div>
