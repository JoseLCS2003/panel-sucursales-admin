<div
  class="flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-4"
>
  <div
    class="w-full max-w-md bg-white p-8 rounded-2xl shadow-2xl space-y-6 border border-gray-100"
  >
    <div class="text-center">
      <div
        class="mx-auto w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center mb-4 shadow-lg"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="32"
          height="32"
          viewBox="0 0 24 24"
          fill="none"
          stroke="white"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
          <polyline points="9 22 9 12 15 12 15 22" />
        </svg>
      </div>
      <h2 class="text-3xl font-bold text-gray-800 mb-2">Panel de Sucursales</h2>
      <p class="text-gray-500">Ingresa tus credenciales para continuar</p>
    </div>

    <!-- Formulario de Login -->
    <form
      *ngIf="!requires2FA"
      [formGroup]="loginForm"
      (submit)="login($event)"
      class="space-y-6"
    >
      <div>
        <label for="email" class="block text-sm font-medium text-gray-700 mb-2"
          >Correo Electrónico <span class="text-red-500">*</span></label
        >
        <div class="relative">
          <div
            class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="text-gray-400"
            >
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
              <circle cx="12" cy="7" r="4" />
            </svg>
          </div>
          <input
            type="email"
            id="email"
            formControlName="email"
            [class.border-red-500]="hasError(loginForm, 'email')"
            [class.border-gray-300]="!hasError(loginForm, 'email')"
            class="block w-full pl-10 pr-3 py-3 border rounded-xl leading-5 bg-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 sm:text-sm"
            placeholder="admin@empresa.com"
          />
        </div>
        <p
          *ngIf="hasError(loginForm, 'email')"
          class="mt-1 text-sm text-red-600"
        >
          {{ getErrorMessage(loginForm, "email") }}
        </p>
      </div>

      <div>
        <label
          for="password"
          class="block text-sm font-medium text-gray-700 mb-2"
          >Contraseña <span class="text-red-500">*</span></label
        >
        <div class="relative">
          <div
            class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="text-gray-400"
            >
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
              <path d="M7 11V7a5 5 0 0 1 10 0v4" />
            </svg>
          </div>
          <input
            type="password"
            id="password"
            formControlName="password"
            [class.border-red-500]="hasError(loginForm, 'password')"
            [class.border-gray-300]="!hasError(loginForm, 'password')"
            class="block w-full pl-10 pr-3 py-3 border rounded-xl leading-5 bg-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 sm:text-sm"
            placeholder="••••••••"
          />
        </div>
        <p
          *ngIf="hasError(loginForm, 'password')"
          class="mt-1 text-sm text-red-600"
        >
          {{ getErrorMessage(loginForm, "password") }}
        </p>
      </div>

      <div
        *ngIf="loginError"
        class="flex items-center p-3 bg-red-50 rounded-xl border border-red-100 animate-pulse"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="text-red-500 flex-shrink-0 mr-2"
        >
          <circle cx="12" cy="12" r="10" />
          <line x1="12" x2="12" y1="8" y2="12" />
          <line x1="12" x2="12.01" y1="16" y2="16" />
        </svg>
        <p class="text-sm text-red-700 font-medium">{{ loginError }}</p>
      </div>

      <button
        type="submit"
        [disabled]="loading"
        class="w-full py-3 px-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:from-blue-700 hover:to-indigo-700 transition duration-300 transform hover:-translate-y-0.5 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"
      >
        {{ loading ? "Iniciando Sesión..." : "Iniciar Sesión" }}
      </button>
    </form>

    <!-- Formulario de Verificación 2FA -->
    <div *ngIf="requires2FA" class="space-y-6">
      <div class="text-center mb-6">
        <div
          class="mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="32"
            height="32"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="text-blue-600"
          >
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
            <path d="M7 11V7a5 5 0 0 1 10 0v4" />
          </svg>
        </div>
        <h3 class="text-xl font-bold text-gray-900">
          Verificación de Dos Pasos
        </h3>
        <p class="text-sm text-gray-500 mt-2">
          Hemos enviado un código de verificación a tu correo electrónico:
          <strong>{{ loginForm.get("email")?.value }}</strong>
        </p>
      </div>

      <form [formGroup]="twoFactorForm">
        <div>
          <label for="code" class="block text-sm font-medium text-gray-700 mb-2"
            >Código de Verificación <span class="text-red-500">*</span></label
          >
          <input
            type="text"
            id="code"
            formControlName="code"
            [class.border-red-500]="hasError(twoFactorForm, 'code')"
            [class.border-gray-300]="!hasError(twoFactorForm, 'code')"
            class="block w-full text-center tracking-[0.5em] text-2xl font-bold py-3 border rounded-xl bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200"
            placeholder="000000"
            maxlength="6"
          />
          <p
            *ngIf="hasError(twoFactorForm, 'code')"
            class="mt-1 text-sm text-red-600 text-center"
          >
            {{ getErrorMessage(twoFactorForm, "code") }}
          </p>
        </div>
      </form>

      <div
        *ngIf="loginError"
        class="flex items-center p-3 bg-red-50 rounded-xl border border-red-100"
      >
        <p class="text-sm text-red-700 font-medium w-full text-center">
          {{ loginError }}
        </p>
      </div>

      <button
        (click)="verify2FA()"
        [disabled]="loading"
        class="w-full py-3 px-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:from-blue-700 hover:to-indigo-700 transition duration-300 transform hover:-translate-y-0.5 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"
      >
        {{ loading ? "Verificando..." : "Verificar Código" }}
      </button>

      <div class="text-center mt-4">
        <button
          (click)="resend2FA()"
          class="text-sm text-blue-600 hover:text-blue-800 font-medium focus:outline-none"
        >
          ¿No recibiste el código? Reenviar
        </button>
      </div>

      <div class="text-center mt-2">
        <button
          (click)="requires2FA = false; loginError = ''"
          class="text-sm text-gray-500 hover:text-gray-700 focus:outline-none"
        >
          Volver al inicio de sesión
        </button>
      </div>
    </div>
  </div>
</div>
